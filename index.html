<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARTSTOR 2</title>
    <style>
        @keyframes researchTool {
            from {transform: rotate(0deg);}
            to {transform: rotate(360deg);}
        }
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 0;
            padding: 0 24px 120px;
        }
        button {
            cursor: pointer;
        }
        button.research-tool {
            outline: 2px solid red;
            background-color: magenta;
            color: green;
            animation-name: researchTool;
            animation-duration: 15s;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            position: fixed;
            right: 100px;
            bottom: 40px;
            font-size: 20px;
            padding: 16px 20px;
        }
        button.research-tool:hover {
            outline: 2px solid red;
            background-color: cyan;
            color: magenta;
        }
        .research-tool-modal {
            display: none;
            border: 8px solid greenyellow;
            border-radius: 8px;
            background-color: cyan;
            color: red;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            height: 200px;
            width: 400px;
            z-index: 10;
        }
        .close-research-tool {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .modal-text {
            margin: 30px;
        }
        #viewer {
            height: 70vh;
            width: 100%;
            border: 12px double hotpink;
            margin: 24px 0;
            background: #111;
        }
        #viewer-status {
            min-height: 24px;
            font-size: 14px;
            color: #333;
        }
        .image-menu {
            display: grid;
            gap: 16px;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            margin-bottom: 80px;
        }
        .image-menu section {
            border: 3px dashed deeppink;
            padding: 12px;
            background: #fbeaff;
        }
        .image-menu button {
            display: block;
            width: 100%;
            margin-top: 8px;
            padding: 10px;
            border: 2px solid purple;
            background: #fff;
            color: #333;
            font-size: 14px;
            text-align: left;
        }
        .image-menu button:hover,
        .image-menu button:focus {
            background: #ffe8ff;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/openseadragon.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        function closeResearchTool() {
            const modal = document.getElementById("research-tool-modal");
            modal.style.display = "none";
        }

        function displayResearchTool() {
            const modal = document.getElementById("research-tool-modal");
            modal.style.display = "block";
        }

        window.addEventListener("DOMContentLoaded", () => {
            if (typeof OpenSeadragon !== "function") {
                console.error("OpenSeadragon library failed to load");
                const statusFallback = document.getElementById("viewer-status");
                if (statusFallback) {
                    statusFallback.textContent = "Viewer library failed to load.";
                }
                return;
            }

            const viewer = OpenSeadragon({
                id: "viewer",
                prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/images/",
                showNavigator: true,
                navigatorAutoFade: false,
                animationTime: 0.8,
                blendTime: 0.2,
                maxZoomPixelRatio: 2,
                // crossOriginPolicy: "Anonymous",
                origin: "http://firefly.jstor.org"
            });

            const statusNode = document.getElementById("viewer-status");
            const menuContainer = document.getElementById("image-menu");
            const buttons = menuContainer ? Array.from(menuContainer.querySelectorAll("button[data-tile-source]")) : [];
            let currentLabel = buttons[0]?.getAttribute("data-label") || buttons[0]?.textContent.trim() || "";

            const setStatus = (message) => {
                if (statusNode) {
                    statusNode.textContent = message;
                }
            };

            const loadTile = (tileSource, label) => {
                if (!tileSource) {
                    setStatus("No image URL provided.");
                    return;
                }

                currentLabel = label || tileSource;
                setStatus(`Loading ${currentLabel}â€¦`);

                const isDeepZoom = tileSource.endsWith(".dzi") || tileSource.endsWith(".xml") || tileSource.includes("info.json");

                const handleSuccess = () => {
                    setStatus(`Showing ${currentLabel}`);
                };

                const handleError = (event) => {
                    setStatus(`Could not load image (${currentLabel}).`);
                    console.error("OpenSeadragon failed", event);
                };

                if (isDeepZoom) {
                    viewer.open(tileSource).then(handleSuccess).catch(handleError);
                    return;
                }

                viewer.world.removeAll();
                viewer.addSimpleImage({
                    url: tileSource,
                    success: handleSuccess,
                    error: handleError
                });
            };

            if (!buttons.length) {
                setStatus("No images configured.");
                return;
            }

            buttons.forEach((button) => {
                const tileSource = button.getAttribute("data-tile-source");
                const label = button.getAttribute("data-label") || button.textContent.trim();
                button.addEventListener("click", () => {
                    loadTile(tileSource, label);
                });
            });

            const defaultButton = buttons[0];
            const defaultSource = defaultButton.getAttribute("data-tile-source");
            const defaultLabel = defaultButton.getAttribute("data-label") || defaultButton.textContent.trim();
            if (defaultSource) {
                loadTile(defaultSource, defaultLabel);
            }
        });
    </script>
</head>
<body>
    <h1>ARTSTOR 2</h1>
    <h2>I am stealing these images from JSTOR to make my own website for art research. <br> I call it: ARTSTOR 2</h2>
    <div id="viewer"></div>
    <div id="viewer-status">Select an image from the buttons below.</div>
    <div>these ones should show up (Demo image is hosted by OpenSeadragon and should work anywhere.)</div>
    <div id="image-menu" class="image-menu">
        <section>
            <h3>demo</h3>
            <button type="button" data-label="demo (Highsmith DZI)" data-tile-source="https://openseadragon.github.io/example-images/highsmith/highsmith.dzi">demo (Highsmith DZI)</button>
        </section>
        <section>
            <h3>prod</h3>
            <button type="button" data-label="prod #1" data-tile-source="https://www.jstor.org/iiif/2017/01/03/21/0a358e42-3ffd-4f87-bfd1-6b4d9f3f86b3_deflate.tif/full/max/0/default.jpg">prod #1</button>
            <button type="button" data-label="prod #2" data-tile-source="https://www.jstor.org/iiif/2016/05/11/01/c6d7efbf-5e0e-4fb4-b271-1169172cb8bc_deflate.tif/full/max/0/default.jpg">prod #2</button>
            <button type="button" data-label="prod #3" data-tile-source="https://www.jstor.org/iiif/2020/05/07/01/29df61cd-12d0-4f26-bea6-cffde1c17b31_deflate.tif/full/full/0/default.jpg">prod #3</button>
            <button type="button" data-label="prod #4" data-tile-source="https://stor.artstor.org/iiif/2012/08/14/14/d1e7e379-2918-4b9a-8a7d-9f00589d51ee_deflate.tif/full/max/0/default.jpg">prod #4</button>
        </section>
        <section>
            <h3>firefly</h3>
            <button type="button" data-label="firefly #1" data-tile-source="https://firefly.jstor.org/iiif/2024/12/05/16/d085f050-4f22-492f-be2c-6f1fb3ec692f_deflate.tif/full/max/0/default.jpg">firefly #1</button>
            <button type="button" data-label="firefly #2" data-tile-source="https://firefly.jstor.org/iiif/2024/05/16/17/c03a97cb-9d3e-4db9-9e03-19d3a0fb6c71_deflate.tif/full/max/0/default.jpg">firefly #2</button>
            <button type="button" data-label="firefly #3" data-tile-source="https://stor.stage.artstor.org/iiif/2020/10/30/22/8a5bb4c6-5538-4fa5-bfac-e957730eab4d_deflate.tif/full/full/0/default.jpg">firefly #3</button>
            <button type="button" data-label="firefly #4" data-tile-source="https://stor.stage.artstor.org/iiif/2024/03/12/20/e49306ea-7c28-4b69-b813-716e36a05b5c_deflate.tif/full/max/0/default.jpg">firefly #4</button>
        </section>
        <section>
            <h3>bonus</h3>
            <button type="button" data-label="duplicate firefly #2" data-tile-source="https://firefly.jstor.org/iiif/2024/05/16/17/c03a97cb-9d3e-4db9-9e03-19d3a0fb6c71_deflate.tif/full/max/0/default.jpg">duplicate firefly #2</button>
            <button type="button" data-label="duplicate firefly #4" data-tile-source="https://firefly.jstor.org/iiif/2024/03/12/20/e49306ea-7c28-4b69-b813-716e36a05b5c_deflate.tif/full/max/0/default.jpg">duplicate firefly #4</button>
            <button type="button" data-label="duplicate stage #1" data-tile-source="https://firefly.jstor.org/iiif/2020/10/30/22/8a5bb4c6-5538-4fa5-bfac-e957730eab4d_deflate.tif/full/full/0/default.jpg">duplicate stage #1</button>
        </section>
    </div>

<!--    <button onclick="displayResearchTool()" class="research-tool">-->
<!--        CLICK HERE TO USE THE NEW <br>-->
<!--        ARSTOR 2 RESEARCH TOOL!!-->
<!--    </button>-->

<!--    <div id="research-tool-modal" class="research-tool-modal">-->
<!--        <button onclick="closeResearchTool()" class="close-research-tool">[ X ]</button>-->
<!--            <div class="modal-text">-->
<!--                The "ARTSTOR 2 RESEARCH TOOL" is still under construction. Please check back for further updates on the <b><i>future of academic research!</i></b> <br>-->
<!--            </div>-->
<!--    </div>-->
</body>
</html>
